From 33e558470fa8a0f65daa9e8a011ca408a0eb5397 Mon Sep 17 00:00:00 2001
From: Jianchao Wang <jianchao.wang@nxp.com>
Date: Tue, 7 Aug 2018 16:36:01 +0800
Subject: [PATCH] realize the function that can compile CANopen on different
 platform

Signed-off-by: Jianchao Wang <jianchao.wang@nxp.com>
---
 app/Makefile    | 52 ----------------------------------------------------
 app/Makefile.in | 52 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 configure       |  3 ++-
 3 files changed, 54 insertions(+), 53 deletions(-)
 delete mode 100644 app/Makefile
 create mode 100644 app/Makefile.in

diff --git a/app/Makefile b/app/Makefile
deleted file mode 100644
index 8b3b41f..0000000
--- a/app/Makefile
+++ /dev/null
@@ -1,52 +0,0 @@
-CC = arm-linux-gnueabihf-gcc
-INCLUDES = -I./inc -I../include -I../include/unix -I../include/timers_unix
-SRCDIR_PREFIX = ../drivers
-CAN_TYPE = socket
-TIMER_TYPE = unix
-OBJDIR = ./obj/
-LIBDIR = -L../src
-LIB = -lrt -lpthread $(LIBDIR)
-TARGETDIR = ../src/
-TARGET = $(TARGETDIR)unix
-PREFIX = /usr
-ENABLE_LSS = 0
-
-OBJS = $(TARGET)_objacces.o $(TARGET)_lifegrd.o $(TARGET)_sdo.o \
-	$(TARGET)_pdo.o $(TARGET)_sync.o $(TARGET)_nmtSlave.o \
-	$(TARGET)_nmtMaster.o $(TARGET)_states.o $(TARGET)_timer.o \
-	$(TARGET)_dcf.o $(TARGET)_emcy.o \
-	$(OBJDIR)can_socket.o $(OBJDIR)timers_unix.o $(OBJDIR)CANopen-app.o \
-	$(OBJDIR)TestMaster.o $(OBJDIR)callback.o $(OBJDIR)console.o \
-	$(OBJDIR)cmdTable.o
-
-ifeq ($(ENABLE_LSS),1)
-OBJS += $(TARGET)_lss.o
-endif
-
-CANopen-app : $(OBJS)
-	$(CC) -o CANopen-app $(OBJS) $(LIB)
-
-$(OBJDIR)can_$(CAN_TYPE).o : $(SRCDIR_PREFIX)/can_$(CAN_TYPE)/can_$(CAN_TYPE).c
-	$(CC) $(INCLUDES) -c $(SRCDIR_PREFIX)/can_$(CAN_TYPE)/can_$(CAN_TYPE).c -o $(OBJDIR)can_$(CAN_TYPE).o
-
-$(OBJDIR)timers_$(TIMER_TYPE).o : $(SRCDIR_PREFIX)/timers_$(TIMER_TYPE)/timers_$(TIMER_TYPE).c
-	$(CC) $(INCLUDES) -c $(SRCDIR_PREFIX)/timers_$(TIMER_TYPE)/timers_$(TIMER_TYPE).c -o $(OBJDIR)timers_$(TIMER_TYPE).o
-
-$(OBJDIR)%.o : %.c
-	$(CC) $(INCLUDES) -c $< -o $@
-
-$(TARGET)_%.o : $(TARGETDIR)%.c
-	@echo " "
-	@echo "*********************************************"
-	@echo "**Compiling $< -> $@"
-	@echo "*********************************************"
-	$(CC) -O2 $(INCLUDES) -o $@ -c $<
-
-install: CANopen-app
-	mkdir -p $(DESTDIR)$(PREFIX)/bin/
-	cp $< $(DESTDIR)$(PREFIX)/bin/
-
-clean:
-	rm obj/*.o
-	rm ../src/*.o
-	rm CANopen-app
diff --git a/app/Makefile.in b/app/Makefile.in
new file mode 100644
index 0000000..2db1114
--- /dev/null
+++ b/app/Makefile.in
@@ -0,0 +1,52 @@
+CC = SUB_CC
+INCLUDES = -I./inc -I../include -I../include/unix -I../include/timers_unix
+SRCDIR_PREFIX = ../drivers
+CAN_TYPE = socket
+TIMER_TYPE = unix
+OBJDIR = ./obj/
+LIBDIR = -L../src
+LIB = -lrt -lpthread $(LIBDIR)
+TARGETDIR = ../src/
+TARGET = $(TARGETDIR)unix
+PREFIX = /usr
+ENABLE_LSS = 0
+
+OBJS = $(TARGET)_objacces.o $(TARGET)_lifegrd.o $(TARGET)_sdo.o \
+	$(TARGET)_pdo.o $(TARGET)_sync.o $(TARGET)_nmtSlave.o \
+	$(TARGET)_nmtMaster.o $(TARGET)_states.o $(TARGET)_timer.o \
+	$(TARGET)_dcf.o $(TARGET)_emcy.o \
+	$(OBJDIR)can_socket.o $(OBJDIR)timers_unix.o $(OBJDIR)CANopen-app.o \
+	$(OBJDIR)TestMaster.o $(OBJDIR)callback.o $(OBJDIR)console.o \
+	$(OBJDIR)cmdTable.o
+
+ifeq ($(ENABLE_LSS),1)
+OBJS += $(TARGET)_lss.o
+endif
+
+CANopen-app : $(OBJS)
+	$(CC) -o CANopen-app $(OBJS) $(LIB)
+
+$(OBJDIR)can_$(CAN_TYPE).o : $(SRCDIR_PREFIX)/can_$(CAN_TYPE)/can_$(CAN_TYPE).c
+	$(CC) $(INCLUDES) -c $(SRCDIR_PREFIX)/can_$(CAN_TYPE)/can_$(CAN_TYPE).c -o $(OBJDIR)can_$(CAN_TYPE).o
+
+$(OBJDIR)timers_$(TIMER_TYPE).o : $(SRCDIR_PREFIX)/timers_$(TIMER_TYPE)/timers_$(TIMER_TYPE).c
+	$(CC) $(INCLUDES) -c $(SRCDIR_PREFIX)/timers_$(TIMER_TYPE)/timers_$(TIMER_TYPE).c -o $(OBJDIR)timers_$(TIMER_TYPE).o
+
+$(OBJDIR)%.o : %.c
+	$(CC) $(INCLUDES) -c $< -o $@
+
+$(TARGET)_%.o : $(TARGETDIR)%.c
+	@echo " "
+	@echo "*********************************************"
+	@echo "**Compiling $< -> $@"
+	@echo "*********************************************"
+	$(CC) -O2 $(INCLUDES) -o $@ -c $<
+
+install: CANopen-app
+	mkdir -p $(DESTDIR)$(PREFIX)/bin/
+	cp $< $(DESTDIR)$(PREFIX)/bin/
+
+clean:
+	rm obj/*.o
+	rm ../src/*.o
+	rm CANopen-app
diff --git a/configure b/configure
index b63b276..b6c396f 100755
--- a/configure
+++ b/configure
@@ -795,7 +795,8 @@ MAKEFILES=Makefile.in\
 \ drivers/Makefile.in\
 \ objdictgen/Makefile.in\
 \ examples/Makefile.in\
-\ objdictgen/canfestival_config.py.in
+\ objdictgen/canfestival_config.py.in\
+\ app/Makefile.in
 
 # Drivers dependent Makefiles
 if [ "$SUB_TIMERS_DRIVER" != "" ]; then
-- 
2.7.4

